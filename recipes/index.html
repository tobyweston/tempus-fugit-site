
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>tempus-fugit</title>
  <meta name="author" content="Toby Weston">

  
  <meta name="description" content="When a UI asynchronously updates a value, it can be difficult to make assertions in tests reliably. There are typically two approaches to solving &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://tempusfugitlibrary.org/recipes">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="tempus-fugit" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Averia+Libre:300' rel='stylesheet' type='text/css'>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-3327317-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">tempus-fugit</a></h1>
  
    <h2>Java micro-library for writing & testing concurrent code</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:tempusfugitlibrary.org" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
    <li><a href="/">Home</a></li>
    <li><a href="/documentation/">Documentation</a></li>
    <li><a href="/documentation/download">Download</a></li>
    <li><a href="https://github.com/tobyweston/tempus-fugit">Source</a></li>
    <li><a href="/apidocs/">JavaDoc</a></li>
    <li><a href="/recipes">Recipes</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/recipes/2013/03/17/wait-for-ui-element/">Wait for UI Elements in Tests</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-03-17T14:56:00+00:00" pubdate data-updated="true">Mar 17<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>When a UI asynchronously updates a value, it can be difficult to make assertions in tests reliably. There are typically two approaches to solving this, either poll the UI until the value matches the assertion (timing out after a certain amount of time) or make the UI notify your test code that a value has changed.</p>

<p>Using the <code>WaitFor</code> class along with <a href="http://docs.seleniumhq.org/docs/03_webdriver.jsp#">Web Driver</a> allows you to do the former with something like this.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/recipes/2013/03/17/wait-for-ui-element/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/recipes/2012/07/12/optimise-the-number-of-threads/">Optimise the Number of Threads</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-12T19:01:00+01:00" pubdate data-updated="true">Jul 12<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Working out the theoretical optimal number of threads you should use for your application is fairly straightforward. You do, however, need to understand your applications runtime characteristics. Is it mostly occupied with CPU intensive work or is it mostly waiting for IO? A <a href="http://www.yourkit.com/">good profiler</a> will help you to understand your applications profile.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/recipes/2012/07/12/optimise-the-number-of-threads/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/recipes/2012/06/30/handling-interrupt-exceptions/">Handling Interrupt Exceptions</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-06-30T13:01:00+01:00" pubdate data-updated="true">Jun 30<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>How should you handle <code>InterruptedException</code>s?</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="k">try</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="c1">// what to do?</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




</div>
  
  
    <footer>
      <a rel="full-article" href="/recipes/2012/06/30/handling-interrupt-exceptions/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/recipes/2012/06/01/avoid-jmock-finaliser-problems/">Avoid JMock Finaliser Problems</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-06-01T23:22:00+01:00" pubdate data-updated="true">Jun 1<span>st</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The default threading policy for a JMock <code>Mockery</code> warns if the mockery is being used by multiple threads. The <code>SingleThreadedPolicy</code> will output the following.</p>

<pre><code>2012-05-31 07:35:35 ERROR Finalizer [Console$Logger] - the Mockery is not thread-safe: use a Synchroniser to ensure thread safety
</code></pre>

<p>If you really need multi-threaded access to the mockery, it&#8217;s a <a href="/recipes/2012/06/01/making-jmock-thread-safe">straight forward fix</a> to swap the policy out. As in the log line above though, sometimes the JVM&#8217;s finaliser thread sticks it&#8217;s oar in and confuses the <code>SingleThreadedPolicy</code>.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/recipes/2012/06/01/avoid-jmock-finaliser-problems/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/recipes/2012/06/01/timeout-jmock-synchroniser/">Timeout in JMock Synchroniser</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-06-01T21:15:00+01:00" pubdate data-updated="true">Jun 1<span>st</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>JMock&#8217;s <code>Synchroniser</code> serialises access to the mock object&#8217;s &#8220;context&#8221;, it means all invocations of mocked methods call will be <code>synchronized</code> on the same monitor, effectively forcing them to run in sequence without thread safety concerns. As it uses <code>synchronized</code> though, you can (with some effort) get into trouble with tests that never finish.</p>

<p>If you&#8217;re seeing this kind of thing, apart from using the <code>@Test(timeout=1000)</code> annotation, you might consider an alternative <code>ThreadingPolicy</code> implementation using <code>Lock</code>s that can timeout and maintain liveliness.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/recipes/2012/06/01/timeout-jmock-synchroniser/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/recipes/2012/06/01/making-jmock-thread-safe/">Make JMock Thread Safe</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-06-01T19:00:00+01:00" pubdate data-updated="true">Jun 1<span>st</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>By default, JMock&#8217;s &#8220;context&#8221; is not thread safe. All bets are off if you access the <code>Mockery</code> from  multiple threads. Happily, since JMock 2.6.0, you can set a threading policy per mockery.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">Mockery</span> <span class="n">mockery</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JUnit4Mockery</span><span class="o">()</span> <span class="o">{{</span>
</span><span class='line'>  <span class="n">setThreadingPolicy</span><span class="o">(</span><span class="k">new</span> <span class="n">Synchroniser</span><span class="o">());</span>
</span><span class='line'><span class="o">}};</span>
</span></code></pre></td></tr></table></div></figure>


<p>The <code>Synchroniser</code> forces serialisation of each mocked method call using <code>synchronized</code>. Use it when you&#8217;re running multi-threaded style tests using JMock. The default behaviour will warn you if a mockery is being used like this.</p>

<pre><code>the Mockery is not thread-safe: use a Synchroniser to ensure thread safety
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/recipes/2012/05/26/detecting-deadlocks/">Detecting Deadlocks</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-05-26T15:38:00+01:00" pubdate data-updated="true">May 26<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The <code>DeadlockDetector</code> class allows you to programmatically detect basic deadlocks in your Java code. You can output deadlocks using the following code (note that printing a thread dump using the <code>ThreadDump</code> class will automatically attempt to find any deadlocks).</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">DeadlockDetector</span><span class="o">.</span><span class="na">printDeadlocks</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>The <code>DeadlockDecector</code> class will spot Java monitor cyclic locking problems as well as <code>Lock</code> based cyclic problems. It&#8217;s implementation is basically the same as that used by <code>jconsole</code> and <code>jstack</code>. The types of deadlock it can detect can be illustrated in the example below.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/recipes/2012/05/26/detecting-deadlocks/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/recipes/2012/05/20/testing-concurrent-code/">Testing Concurrent Code</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-05-20T20:33:00+01:00" pubdate data-updated="true">May 20<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Testing concurrency can be hard. When you fire up threads from within a test, it&#8217;s difficult not to introduce concurrency bugs in the test code and be sure you&#8217;re actually exercising the code with the intended interleaving. There must be a better way&#8230;</p>

<h2>Separate the Concurrency Policy from Behaviour</h2>

<p><a href="http://www.growing-object-oriented-software.com/">GOOS</a> amongst other people recommend separating the concurrency policy from the parts of the system that are doing the work. So, for example, if you have some form of &#8220;executor&#8221; which is responsible for farming work out concurrently and behaviour defined separately, you can test each independently and just verify that they collaborate to achieve &#8220;worker&#8221; behaviour concurrently. Make sense?</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/recipes/2012/05/20/testing-concurrent-code/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  <div class="pagination">
    
    <a href="/recipes/archives">Recipe Archive</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
    <h1>Recent Recipes</h1>
    <ul id="recent_posts">
        
        <li class="post">
            <a href="/recipes/2013/03/17/wait-for-ui-element/">Wait for UI Elements in Tests</a>
        </li>
        
        <li class="post">
            <a href="/recipes/2012/07/12/optimise-the-number-of-threads/">Optimise the Number of Threads</a>
        </li>
        
        <li class="post">
            <a href="/recipes/2012/06/30/handling-interrupt-exceptions/">Handling Interrupt Exceptions</a>
        </li>
        
        <li class="post">
            <a href="/recipes/2012/06/01/avoid-jmock-finaliser-problems/">Avoid JMock Finaliser Problems</a>
        </li>
        
        <li class="post">
            <a href="/recipes/2012/06/01/timeout-jmock-synchroniser/">Timeout in JMock Synchroniser</a>
        </li>
        
        <li class="post">
            <a href="/recipes/2012/06/01/making-jmock-thread-safe/">Make JMock Thread Safe</a>
        </li>
        
        <li class="post">
            <a href="/recipes/2012/05/26/detecting-deadlocks/">Detecting Deadlocks</a>
        </li>
        
        <li class="post">
            <a href="/recipes/2012/05/20/testing-concurrent-code/">Testing Concurrent Code</a>
        </li>
        
    </ul>
    <p><a href="/recipes/archives">Recipe Archive</a></p>
</section>

<section>
    </br>
    </br>
    <!--<blockquote>-->
        <!--<p>-->
            <!--"Debugging is twice as hard as writing the code in the first place. Therefore, if you write the code as-->
            <!--cleverly as possible, you are, by definition, not smart enough to debug it”-->
        <!--</p>-->
        <!--<footer>-->
            <!--<strong>Brian Kernighan</strong>-->
            <!--<cite>-->
                <!--<a href="http://www.softwarequotes.com/showquotes.aspx?id=575&name=Brian%20Kernighan">www.softwarequotes.com</a>-->
            <!--</cite>-->
        <!--</footer>-->
    <!--</blockquote>-->
    <blockquote>
        <p>
            "We always strain at the limits of our ability to comprehend the artifacts we construct -- that's true for
            software and for skyscrapers."
        </p>
        <footer>
            <strong>James Gosling</strong>
            <cite>
                <a href="http://www.softwarequotes.com/showquotes.aspx?id=709&name=James%20Gosling">www.softwarequotes.com</a>
            </cite>
        </footer>
    </blockquote>
</section>



<section class="googleplus googleplus-hidden">
  <h1>
    <a href="https://plus.google.com/116267404189265967722?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



    

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2009-2014 - Toby Weston -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a>, theme by <a href="https://twitter.com/#!/alemelandri">@alemelandri</a></span> - <a href="/excludeme">Exclude from analytics</a>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'tempus-fugit-library';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
